generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model MetricsDaily {
  id            String            @id @default(cuid())
  companyId     String
  date          DateTime
  grossRevenue  Decimal           @db.Decimal(12, 2)
  activeMembers Int
  newMembers    Int
  cancellations Int
  trialsStarted Int
  trialsPaid    Int
  createdAt     DateTime          @default(now())
  installation  WhopInstallation? @relation(fields: [companyId], references: [companyId], onDelete: Cascade)

  @@unique([companyId, date])
  @@index([companyId, date])
}

model WorkspaceSettings {
  id             String   @id @default(cuid())
  reportEmail    String
  weeklyEmail    Boolean  @default(true)
  dailyEmail     Boolean  @default(false)
  discordWebhook String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model WhopInstallation {
  id             String         @id @default(cuid())
  companyId      String         @unique
  userId         String?        // Whop user ID for matching memberships
  experienceId   String?        @unique
  plan           String?
  accessToken    String
  username       String?        // User's Whop username
  email          String?        // User's email
  profilePicUrl  String?        // User's profile picture URL
  reportEmail    String?        // Per-company email for reports
  weeklyEmail    Boolean        @default(true)
  dailyEmail     Boolean        @default(false)
  discordWebhook String?        // Per-company Discord webhook
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  metrics        MetricsDaily[]
  
  @@index([userId])
}

model CompanyPrefs {
  companyId      String   @id
  goalAmount     Decimal? @db.Decimal(12, 2)
  wantsDailyMail Boolean  @default(false)
  wantsDiscord   Boolean  @default(false)
  completedAt    DateTime?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("CompanyPrefs")
}
